/**
 * @jest-environment jsdom
 * @jest-environment-options {"url": "http://localhost"}
 */

import { render, screen } from '@testing-library/react';
import {expect, test, act } from '@jest/globals';

// react imports
import React from 'react';

// for design
import 'bootstrap/dist/css/bootstrap.min.css';
import '../style/index.css';

// main component
import Inventory from '../pages/Inventory';


// async function wait(millis) {
//     console.log(`sleeping for ${millis} milliseconds`);
//     await new Promise(r => setTimeout(r, millis));
//     console.log("woke up");
// }
// import { login } from '../util/Functions.js';

test('test#00: renders the inventory page', async () => {
    // console.log("sessionStorage.getItem('token') = " + global.sessionStorage.getItem('token'));
    // console.log("sessionStorage.getItem('userId') = " + global.sessionStorage.getItem('userId'));

    const mockResponse = jest.fn();
    Object.defineProperty(window, 'location', {
        value: {
            hash: {
            endsWith: mockResponse,
            includes: mockResponse,
            },
            assign: mockResponse,
        },
        writable: true,
    });

    // // render test
    render(
        <Inventory />
	);

    // setTimeout(function () {
    //     // expect something that's available after the timeout
    //     done();
    // }, 500);

    // act(() => {
    //     /* fire events that update state */

    // });

    // given that there is a page that allows the user to check the items that they have saved
    expect(screen.getByText('Inventory')).toBeInTheDocument();

    // and a function to add and remove items from the inventory
    expect(screen.getByText('Add')).toBeInTheDocument();

    // await wait(5000);
    await new Promise(process.nextTick);
    expect(screen.getByText('+')).toBeInTheDocument();



    // setTimeout
    // setTimeout(function () {
        
    //     // expect something that's available after the timeout
    //     expect(screen.getByText('Unknown')).toBeInTheDocument();
    //     // done();
    // }, 2000);

    // expect(screen.getByText('Unknown')).toBeInTheDocument();

    // await waitFor(() => {
    // expect(screen.getByTestId('ingredient')).toBeInTheDocument();
    // });

    // expect(screen.getByText('Unknown')).toBeInTheDocument();

    // // And a search bar to type in food that they want to add
    // expect(screen.getByTestId('search-bar')).toBeInTheDocument();

    // let ret = await login("natdat47@gmail.com", "Minecraft1#")
    // .then(async (response) => {
    //     let json = await response.json();
    //     expect(json).not.toBeUndefined();
    //     expect(json).not.toBeNull();

    //     // if(json.token !== undefined) {
    //     //     sessionStorage.setItem("token", json.token);
    //     //     sessionStorage.setItem("userid", json.userId);
    //     //     sessionStorage.setItem("loggedIn", "true");
    //     // }
    //     return json;
    // });

    // console.log(ret);    
}, 70000);